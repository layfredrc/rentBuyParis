import Head from "next/head";
import AccomodationsHub from "../components/accomodationsHub";
import axios from "axios";

const Accomodations = ({ rents, error }) => {
	if (error) {
		return <div>An error occured: {error.message}</div>;
	}

	return (
		<div>
			<Head>
				<title>RentBuyParis</title>
				<meta name="description" content="Generated by create next app" />
				<link rel="icon" href="/favicon.ico" />
			</Head>
			<main>
				<AccomodationsHub rents={rents} />
			</main>
		</div>
	);
};

Accomodations.getInitialProps = async (ctx) => {
	try {
		const qs = require("qs");
		const query = qs.stringify(
			{
				populate: "*",
			},
			{
				encodeValuesOnly: true,
			}
		);

		const res = await axios.get(
			`${process.env.NEXT_PUBLIC_STRAPI_URL}/api/rents?${query}`
		);
		const rents = res.data;
		return { rents };
	} catch (error) {
		return { error };
	}
};

export default Accomodations;
